{% load static %}
<!DOCTYPE html>
<html lang="tr">
<head>

<!-- Meta -->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- Title -->
<title>Site Yönetim Sistemi</title>
<!-- Favicons -->
<link rel="shortcut icon" href="{% static 'img/favicon1.png' %}">
<link rel="apple-touch-icon" href="{% static 'img/favicon1.png' %}">
<link rel="apple-touch-icon" sizes="76x76" href="{% static 'img/favicon1.png' %}">
<link rel="apple-touch-icon" sizes="120x120" href="{% static 'img/favicon1.png' %}">
<link rel="apple-touch-icon" sizes="152x152" href="{% static 'img/favicon1.png' %}">

<style>
    label {
      display: block;
      margin-top: 20px;
      font-weight: bold;
    }
    select, input[type="date"], button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
    }
  </style>

<!-- Google Web Fonts -->
<link href="https://fonts.googleapis.com/css?family=Poppins:600,700" rel="stylesheet">

<!-- CSS Styles -->
<link rel="stylesheet" href="{% static 'css/styles.css' %}">

<!-- CSS Base -->
<link id="theme" rel="stylesheet" href="{% static 'css/themes/theme-green.min.css' %}">


</head>

<body class="header-vertical">

<!-- Loader -->
<div id="page-loader" class="bg-dark dark">
    <svg class="loader" width="32px" height="32px" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><circle class="circle" fill="none" stroke-width="2" stroke-linecap="round" cx="16" cy="16" r="14"></circle></svg>
    <span class="loading-txt text-muted">Loading...</span>
</div>
<!-- Loader / End -->

<!-- Header -->
<header id="header" class="bg-dark dark">

    <!-- Logo -->
    <a href="/panel-sakin.html" class="logo"  style="padding: 0;">
      <img src="{% static 'img/logo.png' %}" style="max-height: 220px;">
    </a>

    <!-- Navigation -->
    <nav id="main-menu">
      <div class="nav-wrapper">
        <ul class="nav nav-primary">
          <li><a href="/panel-sakin.html"><i class="li-home"></i>Ana Sayfa</a></li>
          <li><a href="/sakin-aidat-takip"><i class="li-moneybag"></i>Aidat Takibi</a></li>
          <li><a href="{% url 'duyuru_k' %}"><i class="li-bell"></i>Duyurular</a></li>
          <li><a href="/randevu/" class="active"><i class="li-clock"></i>Randevu Alma</a></li>
          <li><a href="/istek_sikayet_sakin/"><i class="li-email"></i>İstek & Şikayet</a></li>
          <li><a href="/logout/" onclick="cikisYap()"><i class="li-arrow6"></i>Çıkış Yap</a></li>
        </ul>
      </div>  
      <span class="selector"></span>
    </nav>

</header>
<!-- Header / End -->

<!-- Content -->
<div id="content">
  <section class="section">
    <div class="container container-sm">
      <h2>Tesis Randevu Sistemi</h2>
      <div class="row">

        <!-- Randevu Alma Formu -->
        <div class="col-md-6">
          <!-- Uygun seansları listeleyen form -->
          <form method="GET">
            <label for="tesis">Tesis Seç:</label>
            <select name="tesis" id="tesis" required>
              <option value="">-- Seçiniz --</option>
              {% for t in tesisler %}
                <option value="{{ t.ad }}" {% if request.GET.tesis == t.ad %}selected{% endif %}>{{ t.ad }}</option>
              {% endfor %}
            </select>
        
            <label for="tarih">Tarih Seç:</label>
            <select name="tarih" id="tarih" required>
              <option value="">-- Tarih Seçin --</option>
              {% for t in tarihler %}
                <option value="{{ t|date:"Y-m-d" }}" {% if request.GET.tarih == t|date:"Y-m-d" %}selected{% endif %}>
                  {{ t|date:"d.m.Y (l)" }}
                </option>
             {% endfor %}
            </select>
            <button type="submit">Uygun Seansları Göster</button>
          </form>

          <!-- Uygun saat varsa -->
          {% if uygun_saatler %}
          <form method="POST">
            {% csrf_token %}
            <input type="hidden" name="tesis" value="{{ request.GET.tesis }}">
            <input type="hidden" name="tarih" value="{{ request.GET.tarih }}">

            <label for="saat">Saat Seç:</label>
            <select name="saat" id="saat" required>
              {% for s in uygun_saatler %}
                <option value="{{ s|time:'H:i' }}">{{ s|time:"H:i" }}</option>
              {% endfor %}
            </select>

            <button type="submit">Randevuyu Onayla</button>
          </form>
          {% elif request.GET.tesis and request.GET.tarih %}
            <p>Seçilen tarihte uygun saat bulunmamaktadır.</p>
          {% endif %}
        </div>

        <!-- Aktif Randevularım -->
        <div class="col-md-6">
          <div class="card p-3 shadow-sm bg-light rounded">
            <h4 class="mb-3 text-primary border-bottom pb-1">Aktif Randevularım</h4>
            {% if messages %}
              {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">{{ message }}</div>
              {% endfor %}
            {% endif %}

            {% if user.is_authenticated %}
              {% for r in user.randevu_set.all %}
                <p>{{ r.tesis.ad }} | {{ r.tarih }} | {{ r.saat|time:"H:i" }}</p>
              {% empty %}
                <p>Henüz randevunuz yok.</p>
              {% endfor %}
            {% endif %}
          </div>
        </div>

      </div>
    </div>
  </section>
</div>
<!-- Content / End -->

<!-- Mobile Navigation Toggle -->
<div id="mobile-nav-toggle" class="header-dark"><span></span><span></span><span></span></div>


<!-- JS Libraries -->
<script src="{% static 'js/jquery-2.2.4.min.js' %}"></script>

<!-- JS Plugins -->
<script src="{% static 'js/plugins.js' %}"></script>

<!-- JS Core -->
<script src="{% static 'js/core.js' %}"></script>


</body>

</html>
